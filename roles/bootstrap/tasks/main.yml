---
#
# Copyright (c) 2017 Jacques-Philippe JUBENOT
# Licensed under CC BY 3.0. All rights reserved.
#

# Role Default

# Add Repository RPM Fusion FREE
- name: Verify if RPM Fusion FREE Repository exist
  stat: path=/etc/yum.repos.d/rpmfusion-free.repo
  register: fusionfrepo
  tags:
    - repofusion
    - basicinst

- name: Add Repository RPM Fusion FREE
  command: dnf install -y --nogpgcheck https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ fedora_version }}.noarch.rpm
  when: fusionfrepo.stat.exists == False
  tags:
    - repofusion
    - basicinst

# Add Repository RPM Fusion Non-FREE
- name: Verify if RPM Fusion Non-FREE Repository exist
  stat: path=/etc/yum.repos.d/rpmfusion-nonfree.repo
  register: fusionnfrepo
  tags:
    - repofusion
    - basicinst

- name: Add Repository RPM Fusion Non-FREE
  command: dnf install -y --nogpgcheck https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ fedora_version }}.noarch.rpm
  when: fusionnfrepo.stat.exists == False
  tags:
    - repofusion
    - basicinst

# Add Repository Oracle VirtualBox
- name: Verify if Oracle VirtualBox Repository exist
  stat: path=/etc/yum.repos.d/virtualbox.repo
  register: repooracle
  tags:
    - repooracle

- name: Add Oracle VirtualBox Repository
  ansible.builtin.yum_repository:
    name: virtualbox
    description: Virtualbox
    baseurl: http://download.virtualbox.org/virtualbox/rpm/fedora/$releasever/$basearch
    enabled: yes
    gpgcheck: yes
    repo_gpgcheck: true
  when: repooracle.stat.exists == False
  tags:
    - repooracle

# Add Repository Google Chrome
- name: Verify if Google Chrome Repository exist
  stat: path=/etc/yum.repos.d/google-chrome.repo
  register: googlechromerepo
  tags:
    - repochrome
    - basicinst

- name: Add Google Chrome Repository
  ansible.builtin.yum_repository:
    name: google-chrome
    description: Google-Chrome
    baseurl: https://dl.google.com/linux/chrome/rpm/stable/x86_64
    enabled: yes
    gpgcheck: yes
    gpgkey: https://dl.google.com/linux/linux_signing_key.pub
  when: googlechromerepo.stat.exists == False
  tags:
    - repochrome
    - basicinst

# Add Repository Lynis
- name: Verify if Lynis Repository exist
  stat: path=/etc/yum.repos.d/lynis-chrome.repo
  register: lynisrepo
  tags:
    - repolynis
    - basicinst

- name: Add Lynis Repository
  ansible.builtin.yum_repository:
    name: lynis
    description: Lynis
    baseurl: https://packages.cisofy.com/community/lynis/rpm/
    gpgkey: https://packages.cisofy.com/keys/cisofy-software-rpms-public.key
    enabled: yes
    gpgcheck: yes
  when: lynisrepo.stat.exists == False
  tags:
    - repolynis
    - basicinst

# Add Repository VScode
- name: Verify if VScode Repository exist
  stat: path=/etc/yum.repos.d/vscode.repo
  register: vscoderepo
  tags:
    - repovscode
    - basicinst

- name: VScode enable Repository
  ansible.builtin.yum_repository:
    name: vscode
    description: VSCode
    baseurl: https://packages.microsoft.com/yumrepos/vscode
    gpgkey: https://packages.microsoft.com/keys/microsoft.asc
    enabled: yes
    gpgcheck: yes
  when: vscoderepo.stat.exists == False
  tags:
    - repovscode
    - basicinst

# Fast Mirror Option for DNF
- name: Fast Mirror Option for DNF
  lineinfile: dest=/etc/dnf/dnf.conf line="fastestmirror=true"
  tags:
    - fastdnf
    - basicinst

# Parallel Download for DNF
- name: Parallel Download for DNF
  lineinfile: dest=/etc/dnf/dnf.conf line="max_parallel_downloads=10"
  tags:
    - fastdnf
    - basicinst

# Add ldconfig file to enable lib modules gtk3   # I don't remember for which softwate it was necessary to do that ! Probably PACmanager
#- name: Test gtk3 file modules exist
#  stat: path=/etc/ld.so.conf.d/gtk3.conf
#  register: modulegtk3file
#  tags:
#    - modulegtk3file

#- name: Copy from template gtk3 list modules
#  template: src=templates/gtk3.conf.tpl dest=/etc/ld.so.conf.d/gtk3.conf mode=0644 owner=root group=root
#  when: modulegtk3file.stat.exists == False
#  tags:
#    - modulegtk3file

#- name: Complete gtk3 lib modules file
#  lineinfile: dest=/etc/ld.so.conf.d/gtk3.conf line="/usr/lib64/gtk-3.0/modules"
#  when: modulegtk3file.stat.exists
#  tags:
#    - modulegtk3file

#- name: Reload Dynamic Lync
#  shell: ldconfig
#  when: modulegtk3file.stat.exists
#  tags:
#    - modulegtk3file