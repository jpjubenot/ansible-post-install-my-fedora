---
#
# Copyright (c) 2017 Jacques-Philippe JUBENOT
# Licensed under CC BY 3.0. All rights reserved.
#

# Role Default

# Add Repository RPM Fusion FREE
- name: Verify if RPM Fusion FREE Repository exist
  stat: path=/etc/yum.repos.d/rpmfusion-free.repo
  register: fusionfrepo
  tags:
    repofusion

- name: Downloading and enable RPM Fusion FREE Repository...
  command: dnf install -y --nogpgcheck https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ fedora_version }}.noarch.rpm
  when: fusionfrepo.stat.exists == False
  tags:
    repofusion

# Add Repository RPM Fusion Non-FREE
- name: Verify if RPM Fusion Non-FREE Repository exist
  stat: path=/etc/yum.repos.d/rpmfusion-nonfree.repo
  register: fusionnfrepo
  tags:
    repofusion

- name: Downloading and enable RPM Fusion Non-FREE Repository...
  command: dnf install -y --nogpgcheck https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ fedora_version }}.noarch.rpm
  when: fusionnfrepo.stat.exists == False
  tags:
    repofusion

# Add Repository Adobe
- name: Verify if Adobe Repository exist
  stat: path=/etc/yum.repos.d/adobe-linux-x86_64.repo
  register: adoberepo
  tags:
    repoadobe

- name: Downloading and enable Adobe Repository...
  command: dnf install -y --nogpgcheck http://linuxdownload.adobe.com/adobe-release/adobe-release-x86_64-1.0-1.noarch.rpm
  when: adoberepo.stat.exists == False
  tags:
    repoadobe

# Add Repository Oracle VirtualBox
- name: Verify if Oracle VirtualBox Repository exist
  stat: path=/etc/yum.repos.d/virtualbox.repo
  register: oraclerepo
  tags:
    - oraclerepo

- name: Oracle VirtualBox enable Repository...
  template: src=templates/virtualbox.repo.tpl dest=/etc/yum.repos.d/virtualbox.repo mode=0644 owner=root group=root
  when: oraclerepo.stat.exists == False
  tags:
    - oraclerepo

# Add Repository Google Chrome
- name: Verify if Google Chrome Repository exist
  stat: path=/etc/yum.repos.d/google-chrome.repo
  register: googlechromerepo
  tags:
    repochrome

- name: Google Chrome enable Repository
  template: src=templates/google-chrome.repo.tpl dest=/etc/yum.repos.d/google-chrome.repo mode=0644 owner=root group=root
  when: googlechromerepo.stat.exists == False
  tags:
    repochrome

# Add Repository Lynis
- name: Verify if Lynis Repository exist
  stat: path=/etc/yum.repos.d/lynis-chrome.repo
  register: googlechromerepo
  tags:
    repolynis

- name: Lynis enable Repository
  template: src=templates/lynis.repo.tpl dest=/etc/yum.repos.d/lynis.repo mode=0644 owner=root group=root
  when: googlechromerepo.stat.exists == False
  tags:
    repolynis

# Fast Mirror Option for DNF
- name: Fast Mirror Option for DNF
  lineinfile: dest=/etc/dnf/dnf.conf line="fastestmirror=true"
  tags:
    - fastmirror

# Disable IPv6 - 3 lines to disable
- name: Disable IPv6 -a
  lineinfile: dest=/etc/sysctl.conf line="net.ipv6.conf.all.disable_ipv6 = 1"
  tags:
    ipv6

- name: Disable IPv6 -b
  lineinfile: dest=/etc/sysctl.conf line="net.ipv6.conf.default.disable_ipv6 = 1"
  tags:
    ipv6

- name: Disable IPv6 -c
  lineinfile: dest=/etc/sysctl.conf line="net.ipv6.conf.lo.disable_ipv6 = 1"
  tags:
    ipv6

# Disable ::1 ipv6 localhost on /etc/hosts
- replace:
     path: /etc/hosts
     regexp: '^::1'
     replace: '#::1'
     backup: yes
  tags:
    ipv6

# Add Blacklist file to disable Webcam
- name: Test blacklist file
  stat: path=/etc/modprobe.d/blacklist.conf
  register: blacklistfile
  tags:
    - blacklistf

- name: Disable Webcam - blacklist file do not exist
  template: src=templates/disable-webcam.conf.tpl dest=/etc/modprobe.d/blacklist.conf mode=0644 owner=root group=root
  when: blacklistfile.stat.exists == False
  tags:
    - blacklistf

- name: Disable Webcam - blacklist file exist
  lineinfile: dest=/etc/modprobe.d/blacklist.conf line="# Disable Webcam on linux"
  when: blacklistfile.stat.exists
  tags:
    - blacklistf

- name: Disable Webcam blacklist file exist
  lineinfile: dest=/etc/modprobe.d/blacklist.conf line="blacklist uvcvideo"
  when: blacklistfile.stat.exists
  tags:
    - blacklistf
